## PROJETO CHATBOT PARA HIST√ìRIAS V5 ##

DESCRI√á√ÉO GEN√âRICA: 
	Chatbot criado em linguagem python com utiliza√ß√£o de LLM atrav√©s do LMStudio rodando localmente, onde ser√£o gerados dois ou mais bots para representar um personagem de uma hist√≥ria, esses personagens devem manter seu hist√≥rico de conversa e caract√©risticas pr√≥prias armazenadas em arquivos e banco de dados, buscando responder e agir interpretando seu respectivo personagem. Os personagens devem interagir com o usu√°rio respondendo cada intera√ß√£o como se o usu√°rio fosse outro personagem. Cada bot ter√° um nome e uma voz unica que ser√° reproduzida ap√≥s a resposta em texto. Os bots devem reagir de acordo com as intera√ß√µes do usu√°rio/player mantendo sempre o contexto da hist√≥ria e coer√™ncia. Al√©m desses bots haver√° um narrador a ser selecionado que ir√° ajudar a contextualizar a hist√≥ria de uma vis√£o externa, sem ativamente participar da hist√≥ria.

PROJETO:
	Este √© um projeto para chatbot de hist√≥rias, sendo executado com intera√ß√µes tanto via terminal quanto em uma interface gr√°fica. 
	
	O programa inicia exibindo op√ß√µes em um menu interativo, onde o usu√°rio seleciona a funcionalidade desejada.

OBJETIVO: 
	O objetivo pricipal √© criar hist√≥rias ricas e envolventes atrav√©s de utiliza√ß√£o de IA (LLM local ou online), criando uma narra√ß√£o interessante, trazendo imer√ß√£o ao usu√°rio/jogador e permitindo que ele conduza os rumos da hist√≥ria conforme responde ou interage atrav√©s de seu personagem (definido no inicio da hist√≥ria), interagindo com os demais personagens (controlados pela Intelig√™ncia Artifical).

INTERA√á√ÉO DO USU√ÅRIO:
	A intera√ß√£o do usu√°rio/player √© feita com a possibilidade de envio de mensagens diretas para o narrador de hist√≥rias ou para os personagens da hist√≥ria.

HIST√ìRIA:
	A hist√≥ria deve ser gerada pela LLM, apresetando ao usu√°rio/player 4 op√ß√µes de hist√≥rias dentro do contexto de uma tema definido pelo usu√°rio atrav√©s do menu.
	Caso o usu√°rio n√£o esteja satisfeito com as hist√≥irias geradas ele pode solicitar gera√ß√£o de novas hist√≥rias.
	
NARRADOR:
	- Descri√ß√£o do narrador:
		O Narrador √© um personagem que n√£o participa ativamente da hist√≥ria, ele √© onisciente com rela√ß√£o aos acontecimentos da hist√≥ria e tem o objetivo apenas de narrar a ajudar a dar contexto na hist√≥ria. N√£o se envolve diretamente, mas responde perguntas do usu√°rio diretamente para ele, por exemplo descri√ß√£o de personagens ou cenas, lembran√ßas de acontecimentos, entre outros.

	- Tipos de narrador
		H√° dois tipos diferentes de narradores:
		- Narrador descritivo que somente explica os acontecimentos e narra as cenas, esse √© o padr√£o
		- Narrador Sassy (esse quebra um pouco as regras), ele √© extremamente irreverente, sarc√°stico e debochado, semelhante ao personagem Coringa do batman. Ele "quebra a quarta parede" e interage diretamente com o usu√°rio, fazendo piadas, tirando sarro de alguma intera√ß√£o do us√°rio entre outras a√ß√µes.

	- Modo de fala: 
		O narrador descreve a cena considerando contexto dos personagens, relacionamentos, sentimentos e desenrolar da hist√≥ria, sempre em terceira pessoa (com excess√£o do narrador sassy que tem a possibilidade de falar direto com o usu[ario /player as vezes).

	- Voz: 
		O narrador possui voz pr√≥pria e perfil pr√≥prio, ou seja h√° mais de um narrador poss√≠vel com estilos diferentes (ver narrator_system.py).

PERSONAGENS:

	- Cria√ß√£o:
		A cria√ß√£o de personagens deve ocorrer automaticamente no inicio da hist√≥ria, com base na hist√≥ria proposta pela LLM e selecionada pelo usu√°rio/player, assim como identificar e adicionar novos personagens a medida que els aparecerem na hist√≥ria. Tamb√©m h√° a possibilidade de buscar novos personagens que possam n√£o ter sido criados automaticamente por conta de algum tipo de falha atrav√©s da fun√ß√£o "analisar hist√≥ria", feita atrav√©s do menu interativo:  8. Analisar hist√≥ria e os personagens existentes podem ser exibidos atrav√©s do menu interativo: "Ver/gerenciar personagens" que permite tamb√©m favoritar ou desfavoritar um personagem com o objetivo de ele n√£o ser exclu√≠do durante o processo de reset de hist√≥ria. Tanto via modo autoim√°tico, quanto com o comando "analisar hist√≥ria" as caracter√≠sticas ser√£o definidas pela IA com base na hist√≥ria e conversa identifdicadas at√© ent√£o, permitindo somente que o usu√°rio/player selecione a voz desejada para o personagem no momento da cria√ß√£o.
		
	- Regras para cria√ß√£o:
		A adi√ß√£o de novos personagens deve ser feita somente ap√≥s uma verifica√ß√£o se o personagem em quest√£o:
			1) J√° n√£o existe
			2) Se o nome citado n√£o √© semelhante a um personagem j√° existe, fazendo o relacionamento caso isso ocorra e evitando de acionar a cria√ß√£o duplicada.
			3) Fazer a cria√ß√£o com nomes pr√≥prios e se poss√≠vel nome e sobrenome, exceto quando tudo indica que √© um novo personagem,. tem caracter√≠sticas pr√≥prias e ainda n√£o foi criado, ent√£o nesse caso, √© criado um personagem com um nome espec√≠fico por exemplo: Homem de capuz (ainda n√£o identificado), ai quando for descoberto a identidade dele, √© atualizado operfil com o nome.
			
	- Intera√ß√£o:
		O usu√°rio/player poder√° interagir com o personagem selecionado-o atrav√©s do menu 1. Falar com personagem, seguido da sele√ß√£o do personagem desejado.
		
		IMPORTANTE: Quando o personagem selecionado n√£o for o narrador, ele deve responder ao personagem do usu√°rio/player em primeira pessoa, se dirigindo diretamente para ele. Quando a LLM mencionar a√ß√µes, comportamentos ou pensamentos do personagem na resposta, seguiido de falas do personagem, o narrador deve descrever essas a√ß√µes, comportamentos ou pensamentos em terceira pessoa (Essa instru√ß√£o deve ser clara para a LLM, caso contr√°rio n√£o ir√° gerar ou output desejado), nesse caso o narrador descreve essas intera√ß√µes, seguido da resposta pelo personagem, seguindo esse processo sempre que ocorrer, mantendo texto e voz pr√≥prios para narrador e personagens alternado at√© o fim da intera√ß√£o, por exemplo:
			Avalon (usu√°rio/player que √© voc√™): Stella porque voc√™ fez isso com a Julia?
			Narrador: Stella pensativa se aproxima da cadeira ao lado da porta do quarto, senta e responde
			Stella: Julia foi estremamete rude comigo... Ela jogou um copo no meu rosto quando fui conversar com ela.
			Narrador: Stella desabafa com pesar....
			
		As intera√ß√µes desse tipo tem uma abordagem que poder√° ser somente a resposta do personagem em primeira pessoa de maneira direta ou uma mesclagem entre personagem e narrador, sendo registradas como intera√ß√£o do personagem para quem est√° sendo dirigido a comunica√ß√£o.
	
SENTIMENTOS:
	Existe uma an√°lise de sentimento na resposta, classificando e exibindo de acordo com a resposta, entona√ß√£o e contexto do personagem com o usu√°rio/player ou com demais personagens, mostrando claramente o que esse personagem est√° sentindo no momento da fala.

RELACIONAMENTO: 
	O sistema de relacionamento de personagens deve considerar o contexto da hist√≥ria, a posi√ß√£o do personagem na a√ß√£o considerando seus objetivos e viv√™ncias, o relacionamento dele com o usu√°rio/player ou outro personagem e emo√ß√µes, para dar legitimidade ao personagem e considerar suas caract√©risitcas pr√≥rpias nas intera√ß√µes, com o objetivo  de criar hist√≥rias consistentes.
	
LUGARES:
	Lugares devem ser criados e adicionados a um banco de dados, de forma semelhante aos personagens, sendo gravados a medida que aparecem na hist√≥ria considerando a descri√ß√£o de suas caracter√≠sticas. O comando analisar hist√≥ria tamb√©m possibilita adiconar lugares que possam na√µ ter sido registrados automaticamente. Os lugares podem ser exibidos atrav√©s da fun√ß√£o: 5. 'Ver lugares" do menu interativo.
	
SISTEMA DE LEMBRAN√áAS
	Acessado via menu interativo: "3. Ver lembran√ßas" pelo terminal ou sele√ß√£o de bot√£o via interface, Grava dados no arquivo character_memories.db em formato SQLite format 3.
	
	O sistema de lembran√ßas recupera "mem√≥rias" dos personagens em um formato mais estruturado e expl√≠cito.Ele guarda de maneira individual as mem√≥rias de intera√ß√µes do usu√°rio com os personagens para que possam ser reculperadas ap√≥s o encerramento do programa, organizando as em formato decrecente de acordo com o hor√°rio da intera√ß√£o, estruturando o registro da seguinte forma:
	
	DATA HORA - EMO√á√ÉO:
	FALA DO USU√ÅRIO | REPOSTA DO PERSONAGEM
	

SISTEMA DE CONTEXTO
Acessado via menu interativo: "2. Ver contexto" pelo terminal ou sele√ß√£o de bot√£o via interface, grava no arquivo story_hystory.db em formato SQLite format 3 √© estruturado via consulta ao hist√≥rico do personagem no character_memories.db e resumido pela LLM.

O sistema de contexto traz um resumo da hist√≥ria, contextualizando atrav√©s das intera√ß√µes com os personagens o ocorrido desde o in√≠cio at√© o atual momento, permitindo o usu√°rio e a LLM se contextualizar com os acontecimentos dar um sequ√™ncia coerente na hist√≥ria, estruturando o registro da seguinte forma:

Escolha uma op√ß√£o (1-10): 2
[DEBUG][StoryChat] Gerando resumo do contexto

=== Contexto Atual ===
Contexto atual da cena:
        Local: Berlim Oriental
        Hor√°rio: dia
        Atmosfera: Neutro

=== Resumo da Hist√≥ria ===
Em Berlim Oriental dos anos 80, Matthias encontrava-se no limiar de uma nova vida ao se juntar a um grupo dissidente planejando escapar para o Ocidente. No entanto, sua jornada foi abruptamente interrompida quando foi descoberto pelos agentes da Stasi. For√ßado a trabalhar como informante, Matthias ficou cada vez mais dividido entre sua lealdade √† causa e as consequ√™ncias morais de suas escolhas.

A tens√£o pol√≠tica permeava todos os aspectos da vida em Berlim Oriental durante aqueles anos, com edif√≠cios g√™meos e muros de concreto marcando a divis√£o entre o Leste e o Oeste. Atrav√©s do seu trabalho como informante para a Stasi, Matthias foi capaz de evitar puni√ß√µes severas, mas o custo moral pesava sobre ele cada dia. Amigos e conhecidos come√ßaram a
	

MODOS DE OPERA√á√ÉO DO PROGRAMA: 
	Utiliza√ß√£o √© feita via terminal e tamb√©m via interface(NO MOMENTO FUNCIONA semelhante a comunica√ß√£o de envio de mensagens do whatsapp).
	
	A id√©ia √© que ambos os modos sejam integrados, permitindo a utiliza√ß√£o pelo usu√°rio de ambas as formas, sem perder funcionalidades e buscando manter o c√≥digo com facilidade. Pode haver mudan√ßas poontuais, devido a diferente usabilidade entre terminal e interface, mas as funcionalidades principais ser√£o iguis em ambos os modos.

CONFIGURA√á√ïES DE EQUIPAMENTO: 

Sistema funcionando em computador local utilizando o aplicativo LMStudio para acesso aos modelos de LLM conectando o programa atrav√©s de API (client OpenAI) que por sua vez executa os processamentos da LLM em uma placa de video RTX 4070, uitilizando tamb√©m um processador 12th Gen Intel(R) Core(TM) i7-12700F e 64 GB de mem√≥ria.

=== Menu Principal ===
	1. Falar com personagem
		- Possui as seguintes possibilidades
			- "Falar com personagens" que pode ser:
				- Narrador (Apenas narra a hist√≥ria em terceira pessoa, descrvendo acontecimentos e a√ß√µes dos personagens, sem intera√ß√£o direta com o usu√°rio)
				- Personagens (Uma conversa direta do personagem do us√∫ario com o personagem interpretado pela LLM (obtido em uma lista de personagens existentes) Essa intera√ß√£o √© direta, ou seja em primeira pessoa, ent√£o o personagem ter√° voz, caracteristicas e lugar pr√≥prio na hist√≥ria, podendo responder diretamente ao player em primeira pessoa.
				- Personagens com Narrador (Essa forma de intera√ß√£o deve ser utilizada sempre que o player (usu√°rio) falar com um personagem, mas a LLM retorna um texto de a√ß√£o, seguido de fala do personagem em primeira pessoa, descrito  por exemplo dessa forma: 
				"Narrador: Milena se aproxima de Jhon e fala com pesar na voz" (reprodu√ß√£o de voz do Narrador)
				"Milena: Eu n√£o sei porque ela fez isso!" (reprodu√ß√£o de voz do personagem)
				
				
	2. Ver contexto (Traz um resumo d√° hist√≥ria at√© o momento para contextualizar o player e a LLM)
	3. Ver lembran√ßas (Traz o hist√≥rico de conversa do personagem selecionado para contextualizar o player e a LLM)
	4. Ver/gerenciar personagens (traz personagens existentes na hist√≥ria at√© o momento, permitindo visualizar seu perfil (caracter√≠sticas) e trocar a voz dso personagem,al√©m de permitr salvar esse personagem como favorito (favoritar/desfavoitar) para evitar que ele seja excluindo durante po procedimento de reset da hist√≥ria).
	5. Ver lugares (traz um hist√≥rico dos lugares mencionados durante o hist√≥rico da conversa, registrando as caracter√≠ticas desses lugares).
	6. Editar hist√≥rico (permite que o usu√°rio remova uma determinada intera√ß√£o com personagens, afim de mudar o rumo dos acontecimentos.
	7. Mudar narrador (permite alterar entre perfis de narradores existentes)
	8. Analisar hist√≥ria (permite analisar o hist√≥rico em busca de personagens e lugares para resgistro caso possam n√£o ter sido adicionados por algum motivo especifico.) 
	9. Resetar hist√≥ria (permita apagar todos os registros de dados do banco de dados, sejam registros de lugares, personagens, hist√≥ricos ou intera√ß√£o e iniciar uma nova hist√≥ria).
	10. Sair


## MODO DE FUNCIONAMENTRO TERMINAL - CLI ##

Terminal (CLI)

Atualmente, no terminal a execu√ß√£o √© a seguinte:

1. Programa √© Carregado.

2. O usu√°rio seleciona o no menu interativo a op√ß√£o desejada. 

3. Caso a op√ß√£o selecionada seja de intera√ß√£o: "1. Falar com personagem" o usu√°rio seleciona se a mensagem de entrada ser√° direcionada para narrador ou personagens, e envia a mensagem que √© encaminhada para processamento, an√°lise de emo√ß√£o e resposta da LLM, fazendo tamb√©m um relacionamento da resposta usu√°rio e personagens.

4. O "sistema" com base na resposta da LLM interpretando personagens ou narrador fornece a resposta em texto considerando a emo√ß√£o da entrada do usu√°rio e emo√ß√£o do personagem com base na hist√≥ria ou caracter√≠sticas do personagem (a emo√ß√£o do personagem √© "mostrada no terminal, exemplo: Estado Emocional: FELIZ üòä, Intensidade: |‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë| 0.40. Narrador n√£o possui emo√ß√£o ao descrever as cenas, mas dependendo do Narrador ele pode interagir com o usu√°rio conforme caracter√≠sticas proprias definidas em seu perfil.

5. O "sistema" segmenta a resposta da LLM para evitar audio truncado, e coloca o audio para reprodu√ß√£o no player, um audio seguido do outro conforme ordem da fala, at√© concluir a fala do personagem ou narrador, utilizando a respectiva voz do personagem ou narrador.
  
## INTERFACE - GUI ##

Atualmente, o funcionamento da Interface √© o seguinte:

1. Programa √© Carregado.

2. O usu√°rio seleciona o tipo de narrador desejado, no momento as op√ß√µes s√£o: 1. Descritivo (Narrador tradicional) ou 2. Escrachado (Narrador irreverente e malicioso). 

3. Usu√°rio digita e envia mensagem de entrada.
	3.1 Mensagem de texto aparece na interface atrelado ao usu√°rio (com respectiva imagem de avatar e nome)

4. Mensagem do usu√°rio √© enviada para processamento e recebimento da resposta da LLM, que efetua a segmenta√ß√£o do texto de resposta do Narrador ou Personagem dependendo da escolha do usu√°rio que pode ser feita atrav√©s de bot√£o em menu ou conforme interpreta√ß√£o do tipo de texto de entrada (o usu√°rio n√£o percebe esse funcionamento).
5. Exibi√ß√£o de mensagem de texto segmentada com resposta do narrador ou personagem em texto para acompanhar a segmenta√ß√£o em audio que ser√° gerada em seguida.

6. Audio √© processado e gravado em forma de segmentos para evitar audio truncado, mantendo o padr√£o do texto para manter a coer√™ncia.

7. √â exibido uma mensagem do personagem ou narrador cont√©ndo o player de a√∫dio com o respectivo segmento de audio correspondente ao texto do narrador ou personagem.

8. O processo √© repetido at√© concluir a transmiss√£o de cada segmento de texto e audio sempre mantendo a ordem do envio para n√£o mudar a entrega da mensagem.